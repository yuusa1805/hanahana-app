<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>キングハナハナ 閉店後設定判別</title>
<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  background: #f5f5f5;
  margin: 0;
  padding: 16px;
}
h1 {
  text-align: center;
}
input, button {
  width: 100%;
  padding: 14px;
  margin: 6px 0;
  font-size: 16px;
}
button {
  background: #ff4d4d;
  color: white;
  border: none;
  border-radius: 6px;
}
.card {
  background: white;
  padding: 16px;
  margin-top: 16px;
  border-radius: 8px;
}
.result-strong {
  color: red;
  font-weight: bold;
}
.small {
  color: #666;
  font-size: 14px;
}
</style>
</head>
<body>

<h1>キングハナハナ<br>閉店後設定判別</h1>

<input id="machine" placeholder="台番号">
<input id="games" placeholder="総回転数">
<input id="bb" placeholder="BIG回数">
<input id="rb" placeholder="REG回数">
<button onclick="analyze()">判別する</button>

<div id="result"></div>

<script>
// 設定別確率（画像準拠）
const settings = [
  {s:1, bb:292, rb:489, sum:183},
  {s:2, bb:280, rb:452, sum:172},
  {s:3, bb:268, rb:420, sum:163},
  {s:4, bb:257, rb:390, sum:154},
  {s:5, bb:244, rb:360, sum:145},
  {s:6, bb:232, rb:332, sum:136},
];

function analyze() {
  const machine = document.getElementById("machine").value;
  const g = Number(document.getElementById("games").value);
  const bb = Number(document.getElementById("bb").value);
  const rb = Number(document.getElementById("rb").value);

  if (!machine || !g || rb === 0) {
    alert("台番号・回転数・REG回数は必須");
    return;
  }

  const rbRate = g / rb;
  const sumRate = g / (bb + rb);
  const bbRate = bb > 0 ? g / bb : null;

  // 推定設定
  let best = null;
  let minDiff = Infinity;

  settings.forEach(st => {
    let diff =
      Math.abs(rbRate - st.rb) * 0.6 +
      Math.abs(sumRate - st.sum) * 0.3;

    if (bbRate) {
      diff += Math.abs(bbRate - st.bb) * 0.1;
    }

    if (diff < minDiff) {
      minDiff = diff;
      best = st;
    }
  });

  // 信頼度計算（100点）
  let score = 0;

  // 回転数（最大60）
  if (g >= 8000) score += 60;
  else if (g >= 5000) score += 50;
  else if (g >= 3000) score += 35;
  else if (g >= 1500) score += 20;
  else score += 10;

  // REG（最大30）
  if (rb >= 30) score += 30;
  else if (rb >= 25) score += 25;
  else if (rb >= 20) score += 20;
  else if (rb >= 15) score += 15;
  else if (rb >= 10) score += 10;
  else if (rb >= 5) score += 5;

  // BIG（最大10）
  if (bb >= 25) score += 10;
  else if (bb >= 20) score += 8;
  else if (bb >= 15) score += 6;
  else if (bb >= 10) score += 4;
  else if (bb >= 5) score += 2;

  let stars = "★☆☆☆☆";
  if (score >= 85) stars = "★★★★★";
  else if (score >= 70) stars = "★★★★☆";
  else if (score >= 50) stars = "★★★☆☆";
  else if (score >= 30) stars = "★★☆☆☆";

  document.getElementById("result").innerHTML = `
    <div class="card">
      <b>台番号：</b>${machine}<br>
      <b>${g}G / BB:${bb} RB:${rb}</b><br><br>

      合算：1/${Math.round(sumRate)}<br>
      REG：1/${Math.round(rbRate)}<br><br>

      <span class="result-strong">
        推定設定：${best.s}
      </span><br>
      信頼度：${stars}<br>
      <div class="small">（スコア：${score}/100）</div>
    </div>
  `;
}
</script>

</body>
</html>
