<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ãƒãƒŠãƒãƒŠè¨­å®šåˆ¤åˆ¥</title>
<style>
body {
  font-family: sans-serif;
  background: #f5f5f5;
  padding: 20px;
}
input, select, button {
  margin: 4px 0;
  padding: 6px;
}
.item {
  background: white;
  padding: 10px;
  margin-top: 10px;
  border-radius: 6px;
}
.good { color: red; font-weight: bold; }
</style>
</head>

<body>

<h2>ğŸŒº ãƒãƒŠãƒãƒŠè¨­å®šåˆ¤åˆ¥</h2>

<label>ãƒ¢ãƒ¼ãƒ‰ï¼š</label>
<select id="mode">
  <option value="open">å–¶æ¥­ä¸­</option>
  <option value="close">é–‰åº—å¾Œ</option>
</select><br>

<input id="machine" placeholder="å°ç•ªå·"><br>
<input id="games" type="number" placeholder="ç·å›è»¢æ•°"><br>
<input id="bb" type="number" placeholder="BB"><br>
<input id="rb" type="number" placeholder="RB"><br>

<button onclick="saveData()">ä¿å­˜</button>
<button onclick="clearData()">å…¨å‰Šé™¤</button>

<div id="list"></div>

<script>
let data = JSON.parse(localStorage.getItem("hanahanaData")) || [];

function saveData() {
  const d = {
    machine: machine.value,
    games: Number(games.value),
    bb: Number(bb.value),
    rb: Number(rb.value),
    mode: mode.value
  };

  if (!d.machine || !d.games) {
    alert("æœªå…¥åŠ›ãŒã‚ã‚Šã¾ã™");
    return;
  }

  data.push(d);
  localStorage.setItem("hanahanaData", JSON.stringify(data));
  render();
}

function clearData() {
  if (confirm("å…¨å‰Šé™¤ã™ã‚‹ï¼Ÿ")) {
    localStorage.removeItem("hanahanaData");
    data = [];
    render();
  }
}

function judge(d) {
  const total = d.bb + d.rb;
  const g = d.games;
  if (total === 0) return { set: "åˆ¤åˆ¥ä¸å¯", star: 1 };

  const rbRate = g / d.rb || Infinity;
  const allRate = g / total;

  let set = 1;
  let star = 1;

  // ğŸ”’ é–‰åº—å¾Œã¯è¶…å³ã—ã‚
  if (d.mode === "close") {
    if (g >= 5000 && d.rb >= 20 && rbRate <= 200 && allRate <= 130) {
      set = 6; star = 5;
    } else if (g >= 4000 && d.rb >= 16 && rbRate <= 230) {
      set = 5; star = 4;
    } else if (g >= 3000 && d.rb >= 12 && rbRate <= 260) {
      set = 4; star = 3;
    } else {
      return { set: "åˆ¤åˆ¥ä¸å¯", star: 1 };
    }
  }

  // âš¡ å–¶æ¥­ä¸­ã¯å¯èƒ½æ€§é‡è¦–
  if (d.mode === "open") {
    if (g >= 2000 && d.rb >= 10 && rbRate <= 240) {
      set = 6; star = 4;
    } else if (g >= 1500 && d.rb >= 7 && rbRate <= 280) {
      set = 5; star = 3;
    } else if (g >= 1200 && d.rb >= 5 && rbRate <= 320) {
      set = 4; star = 2;
    }
  }

  // ğŸš« BB0å¯¾ç­–ï¼ˆå–¶æ¥­ä¸­ã®ã¿ç·©å’Œï¼‰
  if (d.bb === 0 && d.mode === "close") {
    set = "åˆ¤åˆ¥ä¸å¯";
    star = 1;
  }

  return { set, star };
}

function render() {
  list.innerHTML = "";
  data.forEach(d => {
    const total = d.bb + d.rb;
    const allRate = total ? `1/${Math.floor(d.games / total)}` : "-";
    const rbRate = d.rb ? `1/${Math.floor(d.games / d.rb)}` : "-";

    const j = judge(d);

    let extra = "";
    if (d.mode === "open" && j.set >= 4 && j.star >= 4) {
      extra = `<div class="good">ğŸ”¥ ç‹™ã„ç›®</div>`;
    }
    if (d.mode === "close" && j.set >= 4) {
      const level = j.set === 6 ? "å¼·" : j.set === 5 ? "ä¸­" : "å¼±";
      extra = `<div class="good">ğŸ“Š é«˜è¨­å®šï¼ˆ${level}ï¼‰</div>`;
    }

    list.innerHTML += `
      <div class="item">
        <b>å°ç•ªå·ï¼š</b>${d.machine}<br>
        ${d.games}G / BB:${d.bb} RB:${d.rb}<br>
        åˆç®—ï¼š${allRate}ã€€RBï¼š${rbRate}<br>
        æ¨å®šè¨­å®šï¼š${j.set}<br>
        ä¿¡é ¼åº¦ï¼š${"â˜…".repeat(j.star)}${"â˜†".repeat(5-j.star)}
        ${extra}
      </div>
    `;
  });
}

render();
</script>

</body>
</html>
